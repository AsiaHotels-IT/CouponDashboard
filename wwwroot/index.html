<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Coupon Dashboard</title>
    <link href="https://fonts.googleapis.com/css?family=Segoe+UI:400,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(120deg, #f5faff 0%, #eaf3ff 100%);
            margin: 0;
        }
        .menu-bar {
            display: flex;
            height: 80px;
            background: linear-gradient(90deg, #dce4ff 0%, #ffe6aa 100%);
            align-items: center;
            padding: 0 24px;
            box-shadow: 0 2px 8px #e0e4fa;
            position: sticky;
            top: 0;
            z-index: 9;
        }
        .menu-btn {
            margin-right: 12px;
            padding: 14px 34px;
            font-size: 22px;
            border: none;
            border-radius: 12px 12px 0 0;
            background: #f7f9ff;
            color: #3d3180;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 6px #e0e4fa;
            transition: background .2s, color .2s;
        }
        .menu-btn:hover, .menu-btn:focus {
            background: #eaf3ff;
            color: #6645b5;
        }
        .active {
            background: #ffe6aa;
            color: #8a4b0d;
            box-shadow: 0 4px 14px #ffe6aa80;
        }
        .main-panel {
            padding: 36px 8vw 20px 8vw;
            max-width: 900px;
            margin: 0 auto;
        }
        .row-panel {
            display: flex;
            align-items: center;
            min-height: 86px;
            margin-bottom: 22px;
            border-radius: 14px;
            background: #ffffffdd;
            box-shadow: 0 3px 16px #eaf3ff77;
            transition: transform 0.15s;
            border: 2px solid #eaf3ff;
            position: relative;
        }
        .row-panel:hover {
            transform: scale(1.02);
            border-color: #aee1ff;
        }
        .crown {
            font-size: 44px;
            margin-right: 22px;
            filter: drop-shadow(0 0 4px #ffe65088);
        }
        .coupon-name, .sales-name {
            font-size: 28px;
            font-weight: bold;
            flex: 1;
            color: #3d3180;
            letter-spacing: 0.5px;
        }
        .coupon-sales, .sales-total {
            font-size: 25px;
            font-weight: bold;
            text-align: right;
            color: #106c21;
        }
        .gold-bg {
            background: linear-gradient(90deg, #ffe650 0%, #fff2a3 100%) !important;
            border-color: #ffd700 !important;
        }
        .gold-txt {
            color: #8a4b0d !important;
            text-shadow: 0 2px 6px #fff8dc;
        }
        .red-txt {
            color: #dc143c !important;
            text-shadow: 0 2px 8px #ffd6da;
        }
        /* Responsive */
        @media (max-width: 700px) {
            .main-panel { padding: 18px 4vw; }
            .row-panel { min-height: 66px; }
            .coupon-name, .sales-name { font-size: 19px; }
            .coupon-sales, .sales-total { font-size: 18px; }
            .crown { font-size: 30px; }
        }
        /* Loader */
        .loader {
            text-align: center;
            font-size: 28px;
            color: #3d3180;
            margin-top: 60px;
            animation: pulse 1.2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="menu-bar">
        <button id="btnCouponSummary" class="menu-btn active">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
        <button id="btnTopSales" class="menu-btn">Topsales</button>
    </div>
    <div id="mainPanel" class="main-panel"></div>
    <script>
        const couponBtn = document.getElementById('btnCouponSummary');
        const salesBtn = document.getElementById('btnTopSales');
        const mainPanel = document.getElementById('mainPanel');

        couponBtn.onclick = () => {
            couponBtn.classList.add('active');
            salesBtn.classList.remove('active');
            loadCouponSummary();
        };
        salesBtn.onclick = () => {
            salesBtn.classList.add('active');
            couponBtn.classList.remove('active');
            loadTopSales();
        };

        function showLoader() {
            mainPanel.innerHTML = `<div class="loader">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>`;
        }

        function loadCouponSummary() {
            showLoader();
            fetch('/api/coupon/summary')
                .then(r => r.json())
                .then(data => {
                    mainPanel.innerHTML = '';
                    if (!data.length) {
                        mainPanel.innerHTML = '<div class="loader" style="color:#dc143c;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</div>';
                        return;
                    }
                    data.forEach(row => {
                        let name = row.Branch ?? row.branch ?? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
                        let sales = isNaN(row.totalSales) ? 0 : row.totalSales;
                        let panel = document.createElement('div');
                        panel.className = 'row-panel';
                        panel.innerHTML = `
                            <div class="coupon-name">${name}</div>
                            <div class="coupon-sales">${parseFloat(sales).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        `;
                        mainPanel.appendChild(panel);
                    });
                })
                .catch(err => {
                    mainPanel.innerHTML = `<div class="loader" style="color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}</div>`;
                });
        }

        function loadTopSales() {
            showLoader();
            fetch('/api/coupon/topsales')
                .then(r => r.json())
                .then(data => {
                    mainPanel.innerHTML = '';
                    if (!data.length) {
                        mainPanel.innerHTML = '<div class="loader" style="color:#dc143c;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</div>';
                        return;
                    }
                    data.forEach((row, i) => {
                        let name = row.salesPerson ?? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
                        let sales = isNaN(row.totalSales) ? 0 : row.totalSales;
                        let panel = document.createElement('div');
                        panel.className = 'row-panel' + (i === 0 ? ' gold-bg' : '');
                        panel.innerHTML = `
                            ${i === 0 ? '<span class="crown">üëë</span>' : ''}
                            <div class="sales-name${i === 0 ? ' gold-txt' : ''}">${i + 1}. ${name}</div>
                            <div class="sales-total${i === 0 ? ' red-txt' : ''}">${parseFloat(sales).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        `;
                        mainPanel.appendChild(panel);
                    });
                })
                .catch(err => {
                    mainPanel.innerHTML = `<div class="loader" style="color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}</div>`;
                });
        }

        loadCouponSummary();
    </script>
</body>
</html>